/*! bmg-front 02-03-2016 */
var bmg=angular.module("bmg",["ui.router","ui.multiselect","pascalprecht.translate","ngCookies","apiService","config","smoothScroll"]);bmg.config(["$logProvider","$translateProvider","$stateProvider","$urlRouterProvider","config",function(a,b,c,d,e){"use strict";a.debugEnabled(e.debug),b.registerAvailableLanguageKeys(e.LANGUAGE_KEYS,{en_US:"en",en_UK:"en"}).useStaticFilesLoader({prefix:"/translations/",suffix:".json"}).determinePreferredLanguage().fallbackLanguage("en").useCookieStorage(),b.useSanitizeValueStrategy("sanitizeParameters"),c.state("home",{url:"/home",templateUrl:"/templates/home/_home.html",controller:"homeController"}).state("home_new",{url:"/home-v1",templateUrl:"templates/home/_home_new.html",controller:"homeController"}).state("login",{url:"/login",templateUrl:"templates/session/_login.html"}).state("signup",{url:"/signup",templateUrl:"templates/session/_signup.html"}).state("profile",{url:"/profile",templateUrl:"templates/user/_profile.html"}),d.otherwise("home")}]);var apiService=angular.module("apiService",["ngResource","config"]);apiService.factory("api",["$resource","$http","config",function(a,b,c){"use strict";var d={};return d.get=function(a){return b.get(c.API_ENDPOINT_URL+a)},d}]),bmg.filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}}).filter("uniq",function(){return function(a,b){for(var c={},d=[],e=0;e<a.length;e++)"undefined"==typeof c[a[e][b]]&&(c[a[e][b]]="",d.push(a[e]));return d}}).filter("map",function(){return function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d][b]);return c}}),bmg.directive("pagescroll",[function(){return{restrict:"AEC",scope:{next:"=",offset:"="},link:function(a,b,c){a.scrollToId=a.next,a.scrollToOffset=a.offset},templateUrl:function(a,b){return b.template||"/templates/directives/_pagescroll.html"}}}]),bmg.directive("typeahead",[function(){return{restrict:"AEC",scope:{items:"=",prompt:"=",template:"@",label:"@",model:"=",onSelect:"&"},link:function(a,b,c){a.handleSelection=function(b){a.filter=b[a.label],a.model=b,a.current=0,a.selected=!0},a.current=0,a.filter="",a.selected=!0,a.isCurrent=function(b){return a.current===b},a.setCurrent=function(b){a.current=b}},templateUrl:function(a,b){return b.template||"/templates/directives/_typeahead.html"}}}]),bmg.factory("utils",["$log","$translate","api","config","$filter",function(a,b,c,d,e){"use strict";var f={};return f.activitiesFallbackData=[],f.loadCountries=function(b){a.debug("Retrieving the list of activities .."),c.get("/countries.json").success(function(c){b.countries=c,a.debug(b.countries.length+" countries obtained.")}).error(function(b){a.debug("Error while getting countries list! "+b)})},f.loadActivities=function(d){a.debug("Retrieving the list of activities .."),c.get("/activities.json").success(function(c){var f=[];angular.forEach(c,function(a){b("utils.activities."+a.translation_key).then(function(b){a.title=b}),b("utils.activity_categories."+a.category).then(function(b){a.category_title=b}),f.push(a)}),d.activities=e("orderBy")(f,"+category"),a.debug(d.activities.length+" activities obtained.")}).error(function(b){a.debug("Error while getting activities list! "+b)})},f.getCurrentLanguage=function(){return b.use()||b.storage().get(b.storageKey())||b.preferredLanguage()},f.getLanguages=function(){return d.LANGUAGE_KEYS},f.changeLanguage=function(a){b.use(a)},f}]),angular.module("multiselect.tpl.html",[]).run(["$templateCache","$http",function(a,b){b.get("/templates/home/_activities_dropdown.html").success(function(b){a.put("multiselect.tpl.html",b)})}]),bmg.controller("homeController",["$scope","initializer","utils",function(a,b,c){a.activities=[],a.countries=[],c.loadActivities(a),c.loadCountries(a),a.initializeIntro=b.initializeIntro,a.initializeSearch=b.initializeSearch,a.initializeHowItWorks=b.initializeHowItWorks,a.pickActivity=b.pickActivity,a.initializePageScrollers=b.initializePageScrollers,a.sections={search:{next:"activities"},activities:{next:"whybemyguide"},whybemyguide:{next:"blog"},blog:{next:"howitworks"},howitworks:{next:"top"}},a.interests=["art","birds","astronomy","geology","music","dancing","butterflies","mushrooms","archeology","observation","reading","photography","religion","sports","fishing","botany","ecology","history","travel","yoga"]}]),bmg.factory("initializer",["$log",function(a){"use strict";var b,c,d,e,f,g,h,i=660,j=$(window),k=1;return g=function(a){void 0!==a&&a||(a="flow control error");var b=new Error(a);return b.isFlowControl=!0,b},c=function(b){b.className="intro-bg-"+k,k=k%5+1;var c=document.getElementById("imgPrepend");"object"==typeof c&&null!==c&&(a.debug("Background "+k+" prepended.."),c.className="intro-bg-"+k)},e=function(a){a.width=j.outerWidth(),a.height=Math.max(j.outerHeight(),i)},d=function(b){var c,d,e,h=0;c=function(){try{if(b.setAttribute("data-drawing-step",h),f(b),b.hasAttribute("data-drawing-done"))throw g("drawing is done.");h++}catch(c){return c.isFlowControl?a.debug(c.message):a.error(c),e()}},d=setInterval(c,10),e=function(){return clearInterval(d)}},f=function(a){var b,c,d,e,f,g,h;return e=a.width,c=a.height,d=e/2,f=Math.min(a.getAttribute("data-offset"),.7*c),g=a.getAttribute("data-drawing-step"),h=e>=992?0:768>e?g/2:g/4,g>=f/2&&!$("#moto h2").hasClass("focused")&&$("#moto h2").addClass("focused"),g>=f&&!a.getAttribute("data-drawing-done")&&a.setAttribute("data-drawing-done","done"),b=a.getContext("2d"),b.clearRect(0,c-f,e,c),b.beginPath(),b.moveTo(0,c-g),b.quadraticCurveTo(d,c-h,e,c-g),b.lineTo(e,c),b.lineTo(0,c),b.fillStyle="#fafafa",b.fill()},h=function(){var a,b,c,d;c=$("#search");var e=document.getElementById("introCanvas");a=e.height,d=c.outerHeight(),b=j.outerWidth()>767?(a-d)/3:(a-d)/2,c.css("top",b)},b={initializePageScrollers:function(){setTimeout(function(){$(".page-scroller").removeClass("hidden-cs")},3e3),setTimeout(function(){$(".page-scroller .faa-pulse").removeClass("faa-pulse")},1e4)},initializeIntro:function(){a.debug("initializing intro..");var b=document.getElementById("introCanvas");e(b),c(b),setInterval(c,3e4,b),$(window).on("resize",function(){e(b),f(b)}),$(window).resize(),setTimeout(d,1e3,b)},initializeSearch:function(){},initializeHowItWorks:function(){$(window).on("scroll",function(){}),$(window).on("resize",function(){})}}}]),bmg.controller("layoutController",["$scope","utils",function(a,b){a.getCurrentLanguage=b.getCurrentLanguage,a.getLanguages=b.getLanguages,a.changeLanguage=b.changeLanguage,a.scoped=function(a,b){return a?a+"."+b:b}}]),bmg.controller("sessionController",["$scope",function(a){}]);